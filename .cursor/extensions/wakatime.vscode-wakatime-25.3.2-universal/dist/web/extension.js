(()=>{"use strict";var t={185:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=void 0;const s=i(398),a=i(921);class r{static quote(t){return t.includes(" ")?`"${t.replace('"','\\"')}"`:t}static apiKeyInvalid(t){const e="Invalid api key... check https://wakatime.com/api-key for your key";return t&&new RegExp("^(waka_)?[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$","i").test(t)?"":e}static validateProxy(t){if(!t)return"";let e;return e=-1===t.indexOf("\\")?new RegExp("^((https?|socks5)://)?([^:@]+(:([^:@])+)?@)?[\\w\\.-]+(:\\d+)?$","i"):new RegExp("^.*\\\\.+$","i"),e.test(t)||new RegExp("^((https?|socks5)://)?([^:@]+(:([^:@])+)?@)?(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]).){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))(:\\d+)?$","i").test(t)?"":"Invalid proxy. Valid formats are https://user:pass@host:port or socks5://user:pass@host:port or domain\\user:pass"}static formatDate(t){let e="AM",i=t.getHours();i>11&&(e="PM",i-=12),0==i&&(i=12);let s=t.getMinutes();return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]} ${t.getDate()}, ${t.getFullYear()} ${i}:${s<10?`0${s}`:s} ${e}`}static obfuscateKey(t){let e="";return t&&(e=t,t.length>4&&(e="XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXX"+t.substring(t.length-4))),e}static wrapArg(t){return t.indexOf(" ")>-1?'"'+t.replace(/"/g,'\\"')+'"':t}static formatArguments(t,e){let i=e.slice(0);i.unshift(this.wrapArg(t));let s=[],a="";for(let t=0;t<i.length;t++)"--key"==a?s.push(this.wrapArg(this.obfuscateKey(i[t]))):s.push(this.wrapArg(i[t])),a=i[t];return s.join(" ")}static isRemoteUri(t){return!!t&&"vscode-remote"===t.scheme}static apiUrlToDashboardUrl(t){return t.replace("://api.","://").replace("/api/v1","").replace(/^api\./,"").replace("/api","")}static enoughTimePassed(t,e){return t+a.TIME_BETWEEN_HEARTBEATS_MS<e}static isPullRequest(t){return!!t&&"pr"===t.scheme}static isAIChatSidebar(t){return!!t&&!t.fsPath.endsWith(".log")&&"vscode-chat-code-block"===t.scheme}static isPossibleAICodeInsert(t){var e;if(t.document.fileName.endsWith(".log"))return!1;if(1!==t.contentChanges.length)return!1;const i=null===(e=t.contentChanges)||void 0===e?void 0:e[0].text.trim();return!(i.length<=2)&&((i.match(/[\n\r]/g)||[]).length>2||i.length>50)}static getFocusedFile(t){var e;const i=null!=t?t:null===(e=s.window.activeTextEditor)||void 0===e?void 0:e.document;if(i){const t=i.fileName;return r.isRemoteUri(i.uri)?`${i.uri.authority}${i.uri.path}`.replace("ssh-remote+","ssh://"):t}}static isPossibleHumanCodeInsert(t){var e,i,s,a;return 1===t.contentChanges.length&&(1===(null===(e=t.contentChanges)||void 0===e?void 0:e[0].text.trim().length)&&"\n"!==(null===(i=t.contentChanges)||void 0===i?void 0:i[0].text)&&"\r"!==(null===(s=t.contentChanges)||void 0===s?void 0:s[0].text)||0===(null===(a=t.contentChanges)||void 0===a?void 0:a[0].text.length))}static getEditorName(){return this.appNames[s.env.appName]?this.appNames[s.env.appName]:s.env.appName.toLowerCase().includes("visual")?"vscode":s.env.appName.replace(/\s/g,"").toLowerCase()}static isAICapableEditor(){const t=s.env.appName.toLowerCase();return t.includes("cursor")||t.includes("windsurf")}static hasAIExtensions(){return["anthropic.claude-code","codeium.codeium","continue.continue","github.copilot-chat","github.copilot","ms-vscode.vscode-ai-toolkit","openai.openai-gpt-vscode","sourcegraph.cody-ai","supermaven.supermaven","tabnine.tabnine-vscode"].some(t=>{const e=s.extensions.getExtension(t);return e&&e.isActive})}static checkAICapabilities(){return this.isAICapableEditor()||this.hasAIExtensions()}}e.Utils=r,r.appNames={"Arduino IDE":"arduino","Azure Data Studio":"azdata",Cursor:"cursor",Onivim:"onivim","Onivim 2":"onivim","SQL Operations Studio":"sqlops",Trae:"trae","Visual Studio Code":"vscode",Windsurf:"windsurf"}},285:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;const s=i(921);e.Logger=class{constructor(t){this.setLevel(t)}getLevel(){return this.level}setLevel(t){this.level=t}log(t,e){t>=this.level&&(e=`[WakaTime][${s.LogLevel[t]}] ${e}`,t==s.LogLevel.DEBUG&&console.log(e),t==s.LogLevel.INFO&&console.info(e),t==s.LogLevel.WARN&&console.warn(e),t==s.LogLevel.ERROR&&console.error(e))}debug(t){this.log(s.LogLevel.DEBUG,t)}info(t){this.log(s.LogLevel.INFO,t)}warn(t){this.log(s.LogLevel.WARN,t)}warnException(t){void 0!==t.message&&this.log(s.LogLevel.WARN,t.message)}error(t){this.log(s.LogLevel.ERROR,t)}errorException(t){void 0!==t.message&&this.log(s.LogLevel.ERROR,t.message)}}},398:t=>{t.exports=require("vscode")},635:(t,e,i)=>{i.r(e),i.d(e,{__addDisposableResource:()=>P,__assign:()=>r,__asyncDelegator:()=>C,__asyncGenerator:()=>S,__asyncValues:()=>O,__await:()=>T,__awaiter:()=>g,__classPrivateFieldGet:()=>F,__classPrivateFieldIn:()=>N,__classPrivateFieldSet:()=>x,__createBinding:()=>m,__decorate:()=>n,__disposeResources:()=>M,__esDecorate:()=>l,__exportStar:()=>v,__extends:()=>a,__generator:()=>f,__importDefault:()=>B,__importStar:()=>I,__makeTemplateObject:()=>k,__metadata:()=>p,__param:()=>u,__propKey:()=>h,__read:()=>_,__rest:()=>o,__rewriteRelativeImportExtension:()=>j,__runInitializers:()=>c,__setFunctionName:()=>d,__spread:()=>y,__spreadArray:()=>A,__spreadArrays:()=>w,__values:()=>b,default:()=>U});var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},s(t,e)};function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var r=function(){return r=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var a in e=arguments[i])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},r.apply(this,arguments)};function o(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(t);a<s.length;a++)e.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(t,s[a])&&(i[s[a]]=t[s[a]])}return i}function n(t,e,i,s){var a,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var n=t.length-1;n>=0;n--)(a=t[n])&&(o=(r<3?a(o):r>3?a(e,i,o):a(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}function u(t,e){return function(i,s){e(i,s,t)}}function l(t,e,i,s,a,r){function o(t){if(void 0!==t&&"function"!=typeof t)throw new TypeError("Function expected");return t}for(var n,u=s.kind,l="getter"===u?"get":"setter"===u?"set":"value",c=!e&&t?s.static?t:t.prototype:null,h=e||(c?Object.getOwnPropertyDescriptor(c,s.name):{}),d=!1,p=i.length-1;p>=0;p--){var g={};for(var f in s)g[f]="access"===f?{}:s[f];for(var f in s.access)g.access[f]=s.access[f];g.addInitializer=function(t){if(d)throw new TypeError("Cannot add initializers after decoration has completed");r.push(o(t||null))};var m=(0,i[p])("accessor"===u?{get:h.get,set:h.set}:h[l],g);if("accessor"===u){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(n=o(m.get))&&(h.get=n),(n=o(m.set))&&(h.set=n),(n=o(m.init))&&a.unshift(n)}else(n=o(m))&&("field"===u?a.unshift(n):h[l]=n)}c&&Object.defineProperty(c,s.name,h),d=!0}function c(t,e,i){for(var s=arguments.length>2,a=0;a<e.length;a++)i=s?e[a].call(t,i):e[a].call(t);return s?i:void 0}function h(t){return"symbol"==typeof t?t:"".concat(t)}function d(t,e,i){return"symbol"==typeof e&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:i?"".concat(i," ",e):e})}function p(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function g(t,e,i,s){return new(i||(i=Promise))(function(a,r){function o(t){try{u(s.next(t))}catch(t){r(t)}}function n(t){try{u(s.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?a(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,n)}u((s=s.apply(t,e||[])).next())})}function f(t,e){var i,s,a,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=n(0),o.throw=n(1),o.return=n(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function n(n){return function(u){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,n[0]&&(r=0)),r;)try{if(i=1,s&&(a=2&n[0]?s.return:n[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,n[1])).done)return a;switch(s=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return r.label++,{value:n[1],done:!1};case 5:r.label++,s=n[1],n=[0];continue;case 7:n=r.ops.pop(),r.trys.pop();continue;default:if(!((a=(a=r.trys).length>0&&a[a.length-1])||6!==n[0]&&2!==n[0])){r=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){r.label=n[1];break}if(6===n[0]&&r.label<a[1]){r.label=a[1],a=n;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(n);break}a[2]&&r.ops.pop(),r.trys.pop();continue}n=e.call(t,r)}catch(t){n=[6,t],s=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,u])}}}var m=Object.create?function(t,e,i,s){void 0===s&&(s=i);var a=Object.getOwnPropertyDescriptor(e,i);a&&!("get"in a?!e.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,s,a)}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]};function v(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||m(e,t,i)}function b(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function _(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,a,r=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(t){a={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(a)throw a.error}}return o}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(_(arguments[e]));return t}function w(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var s=Array(t),a=0;for(e=0;e<i;e++)for(var r=arguments[e],o=0,n=r.length;o<n;o++,a++)s[a]=r[o];return s}function A(t,e,i){if(i||2===arguments.length)for(var s,a=0,r=e.length;a<r;a++)!s&&a in e||(s||(s=Array.prototype.slice.call(e,0,a)),s[a]=e[a]);return t.concat(s||Array.prototype.slice.call(e))}function T(t){return this instanceof T?(this.v=t,this):new T(t)}function S(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,a=i.apply(t,e||[]),r=[];return s=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(t){return function(e){return Promise.resolve(e).then(t,l)}}),s[Symbol.asyncIterator]=function(){return this},s;function o(t,e){a[t]&&(s[t]=function(e){return new Promise(function(i,s){r.push([t,e,i,s])>1||n(t,e)})},e&&(s[t]=e(s[t])))}function n(t,e){try{(i=a[t](e)).value instanceof T?Promise.resolve(i.value.v).then(u,l):c(r[0][2],i)}catch(t){c(r[0][3],t)}var i}function u(t){n("next",t)}function l(t){n("throw",t)}function c(t,e){t(e),r.shift(),r.length&&n(r[0][0],r[0][1])}}function C(t){var e,i;return e={},s("next"),s("throw",function(t){throw t}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(s,a){e[s]=t[s]?function(e){return(i=!i)?{value:T(t[s](e)),done:!1}:a?a(e):e}:a}}function O(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=b(t),e={},s("next"),s("throw"),s("return"),e[Symbol.asyncIterator]=function(){return this},e);function s(i){e[i]=t[i]&&function(e){return new Promise(function(s,a){!function(t,e,i,s){Promise.resolve(s).then(function(e){t({value:e,done:i})},e)}(s,a,(e=t[i](e)).done,e.value)})}}}function k(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var D=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},E=function(t){return E=Object.getOwnPropertyNames||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[e.length]=i);return e},E(t)};function I(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i=E(t),s=0;s<i.length;s++)"default"!==i[s]&&m(e,t,i[s]);return D(e,t),e}function B(t){return t&&t.__esModule?t:{default:t}}function F(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)}function x(t,e,i,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(t,i):a?a.value=i:e.set(t,i),i}function N(t,e){if(null===e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof t?e===t:t.has(e)}function P(t,e,i){if(null!=e){if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object expected.");var s,a;if(i){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=e[Symbol.asyncDispose]}if(void 0===s){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=e[Symbol.dispose],i&&(a=s)}if("function"!=typeof s)throw new TypeError("Object not disposable.");a&&(s=function(){try{a.call(this)}catch(t){return Promise.reject(t)}}),t.stack.push({value:e,dispose:s,async:i})}else i&&t.stack.push({async:!0});return e}var L="function"==typeof SuppressedError?SuppressedError:function(t,e,i){var s=new Error(i);return s.name="SuppressedError",s.error=t,s.suppressed=e,s};function M(t){function e(e){t.error=t.hasError?new L(e,t.error,"An error was suppressed during disposal."):e,t.hasError=!0}var i,s=0;return function a(){for(;i=t.stack.pop();)try{if(!i.async&&1===s)return s=0,t.stack.push(i),Promise.resolve().then(a);if(i.dispose){var r=i.dispose.call(i.value);if(i.async)return s|=2,Promise.resolve(r).then(a,function(t){return e(t),a()})}else s|=1}catch(t){e(t)}if(1===s)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}()}function j(t,e){return"string"==typeof t&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,i,s,a,r){return i?e?".jsx":".js":!s||a&&r?s+a+"."+r.toLowerCase()+"js":t}):t}const U={__extends:a,__assign:r,__rest:o,__decorate:n,__param:u,__esDecorate:l,__runInitializers:c,__propKey:h,__setFunctionName:d,__metadata:p,__awaiter:g,__generator:f,__createBinding:m,__exportStar:v,__values:b,__read:_,__spread:y,__spreadArrays:w,__spreadArray:A,__await:T,__asyncGenerator:S,__asyncDelegator:C,__asyncValues:O,__makeTemplateObject:k,__importStar:I,__importDefault:B,__classPrivateFieldGet:F,__classPrivateFieldSet:x,__classPrivateFieldIn:N,__addDisposableResource:P,__disposeResources:M,__rewriteRelativeImportExtension:j}},916:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WakaTime=void 0;const s=i(635),a=i(398),r=i(921),o=i(185);e.WakaTime=class{constructor(t,e){this.statusBar=void 0,this.statusBarTeamYou=void 0,this.statusBarTeamOther=void 0,this.lastHeartbeat=0,this.lastDebug=!1,this.lastCompile=!1,this.lastAICodeGenerating=!1,this.dedupe={},this.debounceId=null,this.debounceMs=50,this.AIDebounceId=null,this.AIdebounceMs=1e3,this.AIdebounceCount=0,this.AIrecentPastes=[],this.fetchTodayInterval=6e4,this.lastFetchToday=0,this.disabled=!0,this.isCompiling=!1,this.isDebugging=!1,this.isAICodeGenerating=!1,this.hasAICapabilities=!1,this.teamDevsForFileCache={},this.lastApiKeyPrompted=0,this.heartbeats=[],this.lastSent=0,this.linesInFiles={},this.lineChanges={ai:{},human:{}},this.logger=t,this.config=e}initialize(){"true"==this.config.get("wakatime.debug")&&this.logger.setLevel(r.LogLevel.DEBUG);const t=a.extensions.getExtension("WakaTime.vscode-wakatime");this.extension=null!=t&&t.packageJSON||{version:"0.0.0"},this.agentName=o.Utils.getEditorName(),this.hasAICapabilities=o.Utils.checkAICapabilities(),this.disabled="true"===this.config.get("wakatime.disabled"),this.disabled?this.dispose():this.initializeDependencies()}dispose(){var t,e,i,s;this.sendHeartbeats(),null===(t=this.statusBar)||void 0===t||t.dispose(),null===(e=this.statusBarTeamYou)||void 0===e||e.dispose(),null===(i=this.statusBarTeamOther)||void 0===i||i.dispose(),null===(s=this.disposable)||void 0===s||s.dispose()}initializeDependencies(){this.logger.debug(`Initializing WakaTime v${this.extension.version}`),this.statusBar=a.window.createStatusBarItem("com.wakatime.statusbar",a.StatusBarAlignment.Left,3),this.statusBar.name="WakaTime",this.statusBar.command=r.COMMAND_DASHBOARD,this.statusBarTeamYou=a.window.createStatusBarItem("com.wakatime.teamyou",a.StatusBarAlignment.Left,2),this.statusBarTeamYou.name="WakaTime Top dev",this.statusBarTeamOther=a.window.createStatusBarItem("com.wakatime.teamother",a.StatusBarAlignment.Left,1),this.statusBarTeamOther.name="WakaTime Team Total";const t=this.config.get("wakatime.status_bar_enabled");this.showStatusBar="false"!==t;const e=this.config.get("wakatime.status_bar_team");this.showStatusBarTeam="false"!==e,this.setStatusBarVisibility(this.showStatusBar),this.updateStatusBarText("WakaTime Initializing..."),this.checkApiKey(),this.setupEventListeners(),this.logger.debug("WakaTime initialized.");const i=this.config.get("wakatime.status_bar_coding_activity");this.showCodingActivity="false"!==i,this.updateStatusBarText(),this.updateStatusBarTooltip("WakaTime: Initialized"),this.getCodingActivity()}updateStatusBarText(t){this.statusBar&&(this.statusBar.text=t?"$(clock) "+t:"$(clock)")}updateStatusBarTooltip(t){this.statusBar&&(this.statusBar.tooltip=t)}updateTeamStatusBarTextForCurrentUser(t){this.statusBarTeamYou&&(this.statusBarTeamYou.text=t||"")}updateStatusBarTooltipForCurrentUser(t){this.statusBarTeamYou&&(this.statusBarTeamYou.tooltip=t)}updateTeamStatusBarTextForOther(t){this.statusBarTeamOther&&(this.statusBarTeamOther.text=t||"")}updateStatusBarTooltipForOther(t){this.statusBarTeamOther&&(this.statusBarTeamOther.tooltip=t)}statusBarShowingError(){return!!this.statusBar&&-1!=this.statusBar.text.indexOf("Error")}promptForApiKey(t=!0){let e=this.config.get("wakatime.apiKey")||"";o.Utils.apiKeyInvalid(e)&&(e="");const i={prompt:"WakaTime Api Key",placeHolder:"Enter your api key from https://wakatime.com/api-key",value:e,ignoreFocusOut:!0,password:t,validateInput:o.Utils.apiKeyInvalid.bind(this)};a.window.showInputBox(i).then(t=>{if(null!=t){const e=o.Utils.apiKeyInvalid(t);e?a.window.setStatusBarMessage(e):this.config.update("wakatime.apiKey",t)}else a.window.setStatusBarMessage("WakaTime api key not provided")})}promptForApiUrl(){const t={prompt:"WakaTime Api Url (Defaults to https://api.wakatime.com/api/v1)",placeHolder:"https://api.wakatime.com/api/v1",value:this.config.get("wakatime.apiUrl")||"",ignoreFocusOut:!0};a.window.showInputBox(t).then(t=>{t&&this.config.update("wakatime.apiUrl",t)})}promptForDebug(){let t=this.config.get("wakatime.debug")||"";t&&"true"===t||(t="false");const e={placeHolder:`true or false (current value "${t}")`,value:t,ignoreFocusOut:!0};a.window.showQuickPick(["true","false"],e).then(t=>{null!=t&&(this.config.update("wakatime.debug",t),"true"===t?(this.logger.setLevel(r.LogLevel.DEBUG),this.logger.debug("Debug enabled")):this.logger.setLevel(r.LogLevel.INFO))})}promptToDisable(){const t=this.disabled;let e=this.config.get("wakatime.disabled");e&&"true"===e||(e="false");const i={placeHolder:`disable or enable (extension is currently "${"true"===e?"disabled":"enabled"}")`,ignoreFocusOut:!0};a.window.showQuickPick(["disable","enable"],i).then(e=>{"enable"!==e&&"disable"!==e||(this.disabled="disable"===e,this.disabled!=t&&(this.disabled?(this.config.update("wakatime.disabled","true"),this.logger.debug("Extension disabled, will not report code stats to dashboard"),this.dispose()):(this.config.update("wakatime.disabled","false"),this.initializeDependencies())))})}promptStatusBarIcon(){let t=this.config.get("wakatime.status_bar_enabled")||"";t&&"false"===t||(t="true");const e={placeHolder:`true or false (current value "${t}")`,value:t,ignoreFocusOut:!0};a.window.showQuickPick(["true","false"],e).then(t=>{"true"!==t&&"false"!==t||(this.config.update("wakatime.status_bar_enabled",t),this.showStatusBar="true"===t,this.setStatusBarVisibility(this.showStatusBar))})}promptStatusBarCodingActivity(){let t=this.config.get("wakatime.status_bar_coding_activity")||"";t&&"false"===t||(t="true");const e={placeHolder:`true or false (current value "${t}")`,value:t,ignoreFocusOut:!0};a.window.showQuickPick(["true","false"],e).then(t=>{"true"!==t&&"false"!==t||(this.config.update("wakatime.status_bar_coding_activity",t),"true"===t?(this.logger.debug("Coding activity in status bar has been enabled"),this.showCodingActivity=!0,this.getCodingActivity()):(this.logger.debug("Coding activity in status bar has been disabled"),this.showCodingActivity=!1,this.statusBarShowingError()||this.updateStatusBarText()))})}openDashboardWebsite(){const t=this.getApiUrl(),e=o.Utils.apiUrlToDashboardUrl(t);a.env.openExternal(a.Uri.parse(e))}checkApiKey(){this.hasApiKey(t=>{t||this.promptForApiKey()})}hasApiKey(t){const e=this.config.get("wakatime.apiKey")||"";t(!o.Utils.apiKeyInvalid(e))}setStatusBarVisibility(t){var e,i,s,a,r,o;t?(null===(e=this.statusBar)||void 0===e||e.show(),null===(i=this.statusBarTeamYou)||void 0===i||i.show(),null===(s=this.statusBarTeamOther)||void 0===s||s.show(),this.logger.debug("Status bar icon enabled.")):(null===(a=this.statusBar)||void 0===a||a.hide(),null===(r=this.statusBarTeamYou)||void 0===r||r.hide(),null===(o=this.statusBarTeamOther)||void 0===o||o.hide(),this.logger.debug("Status bar icon disabled."))}setupEventListeners(){const t=[];a.window.onDidChangeTextEditorSelection(this.onChangeSelection,this,t),a.workspace.onDidChangeTextDocument(this.onChangeTextDocument,this,t),a.window.onDidChangeActiveTextEditor(this.onChangeTab,this,t),a.workspace.onDidSaveTextDocument(this.onSave,this,t),a.workspace.onDidChangeNotebookDocument(this.onChangeNotebook,this,t),a.workspace.onDidSaveNotebookDocument(this.onSaveNotebook,this,t),a.tasks.onDidStartTask(this.onDidStartTask,this,t),a.tasks.onDidEndTask(this.onDidEndTask,this,t),a.debug.onDidChangeActiveDebugSession(this.onDebuggingChanged,this,t),a.debug.onDidChangeBreakpoints(this.onDebuggingChanged,this,t),a.debug.onDidStartDebugSession(this.onDidStartDebugSession,this,t),a.debug.onDidTerminateDebugSession(this.onDidTerminateDebugSession,this,t),this.disposable=a.Disposable.from(...t)}onDebuggingChanged(){this.updateLineNumbers(),this.onEvent(!1)}onDidStartDebugSession(){this.isDebugging=!0,this.isAICodeGenerating=!1,this.updateLineNumbers(),this.onEvent(!1)}onDidTerminateDebugSession(){this.isDebugging=!1,this.updateLineNumbers(),this.onEvent(!1)}onDidStartTask(t){t.execution.task.isBackground||t.execution.task.detail&&-1!==t.execution.task.detail.indexOf("watch")||(this.isCompiling=!0,this.isAICodeGenerating=!1,this.updateLineNumbers(),this.onEvent(!1))}onDidEndTask(){this.isCompiling=!1,this.updateLineNumbers(),this.onEvent(!1)}onChangeSelection(t){t.kind!==a.TextEditorSelectionChangeKind.Command&&(this.updateLineNumbers(),this.onEvent(!1))}onChangeTextDocument(t){var e;if(o.Utils.isAIChatSidebar(null===(e=t.document)||void 0===e?void 0:e.uri))this.isAICodeGenerating=!0,this.AIdebounceCount=0;else if(o.Utils.isPossibleAICodeInsert(t)){const t=Date.now();this.recentlyAIPasted(t)&&this.hasAICapabilities&&(this.isAICodeGenerating=!0,this.AIdebounceCount=0),this.AIrecentPastes.push(t)}else o.Utils.isPossibleHumanCodeInsert(t)?(this.AIrecentPastes=[],this.isAICodeGenerating&&(this.AIdebounceCount++,clearTimeout(this.AIDebounceId),this.AIDebounceId=setTimeout(()=>{this.AIdebounceCount>1&&(this.isAICodeGenerating=!1)},this.AIdebounceMs))):this.isAICodeGenerating&&(this.AIdebounceCount=0,clearTimeout(this.AIDebounceId),this.updateLineNumbers());this.isAICodeGenerating&&this.onEvent(!1)}onChangeTab(t){this.isAICodeGenerating=!1,this.updateLineNumbers(),this.onEvent(!1)}onSave(t){this.isAICodeGenerating=!1,this.updateLineNumbers(),this.onEvent(!0)}onChangeNotebook(t){this.updateLineNumbers(),this.onEvent(!1)}onSaveNotebook(t){this.updateLineNumbers(),this.onEvent(!0)}updateLineNumbers(){var t,e,i;const s=null===(t=a.window.activeTextEditor)||void 0===t?void 0:t.document;if(!s)return;const r=o.Utils.getFocusedFile(s);if(!r)return;const n=s.lineCount;void 0===this.linesInFiles[r]&&(this.linesInFiles[r]=n);const u=n-(null!==(e=this.linesInFiles[r])&&void 0!==e?e:n),l=this.isAICodeGenerating?this.lineChanges.ai:this.lineChanges.human;l[r]=(null!==(i=l[r])&&void 0!==i?i:0)+u,this.linesInFiles[r]=n}onEvent(t){Date.now()-this.lastSent>1e3*r.SEND_BUFFER_SECONDS&&this.sendHeartbeats(),clearTimeout(this.debounceId),this.debounceId=setTimeout(()=>{if(this.disabled)return;const e=a.window.activeTextEditor;if(e){const i=e.document;if(i){const s=o.Utils.getFocusedFile(i);if(!s)return;this.currentlyFocusedFile!==s&&(this.updateTeamStatusBarFromJson(),this.updateTeamStatusBar(i));const a=Date.now();(t||o.Utils.enoughTimePassed(this.lastHeartbeat,a)||this.lastFile!==s||this.lastDebug!==this.isDebugging||this.lastCompile!==this.isCompiling||this.lastAICodeGenerating!==this.isAICodeGenerating)&&(this.appendHeartbeat(i,a,e.selection.start,t,this.isCompiling,this.isDebugging,this.isAICodeGenerating),this.lastFile=s,this.lastHeartbeat=a,this.lastDebug=this.isDebugging,this.lastCompile=this.isCompiling,this.lastAICodeGenerating=this.isAICodeGenerating)}}},this.debounceMs)}appendHeartbeat(t,e,i,a,n,u,l){return s.__awaiter(this,void 0,void 0,function*(){const s=o.Utils.getFocusedFile(t);if(!s)return;if(a&&this.isDuplicateHeartbeat(s,e,i))return;const c=Date.now(),h={entity:s,time:c/1e3,is_write:a,lineno:i.line+1,cursorpos:i.character+1,lines_in_file:t.lineCount};this.lineChanges={ai:{},human:{}},u?h.category="debugging":n?h.category="building":l?h.category="ai coding":o.Utils.isPullRequest(t.uri)&&(h.category="code reviewing"),h.ai_line_changes&&(h.ai_line_changes=this.lineChanges.ai[s]),h.human_line_changes&&(h.human_line_changes=this.lineChanges.human[s]);const d=this.getProjectName();d&&(h.alternate_project=d);const p=this.getProjectFolder(t.uri);p&&0===s.indexOf(p)&&(h.project_root_count=this.countSlashesInPath(p));const g=this.getLanguage(t);g&&(h.language=g),t.isUntitled&&(h.is_unsaved_entity=!0),this.logger.debug(`Appending heartbeat to local buffer: ${JSON.stringify(h,null,2)}`),this.heartbeats.push(h),c-this.lastSent>1e3*r.SEND_BUFFER_SECONDS&&(yield this.sendHeartbeats())})}sendHeartbeats(){return s.__awaiter(this,void 0,void 0,function*(){this.hasApiKey(t=>{t?this._sendHeartbeats():this.promptForApiKey()})})}_sendHeartbeats(){return s.__awaiter(this,void 0,void 0,function*(){if(0===this.heartbeats.length)return;this.lastSent=Date.now();const t=this.getPlugin(),e=JSON.stringify(this.heartbeats.map(e=>Object.assign({type:"file",plugin:t},e)));this.heartbeats=[],this.logger.debug(`Sending heartbeats to API: ${JSON.stringify(e)}`);const i=this.config.get("wakatime.apiKey"),s=`${this.getApiUrl()}/users/current/heartbeats.bulk?api_key=${i}`;try{const t=yield fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-Machine-Name":a.env.appHost},body:JSON.stringify(e)}),i=yield t.json();if(200==t.status||201==t.status||202==t.status)this.showStatusBar&&this.getCodingActivity();else if(this.logger.warn(`API Error ${t.status}: ${i}`),t&&401==t.status){const t="Invalid WakaTime Api Key";this.showStatusBar&&(this.updateStatusBarText("WakaTime Error"),this.updateStatusBarTooltip(`WakaTime: ${t}`)),this.logger.error(t);const e=Date.now();this.lastApiKeyPrompted<e-864e5&&(this.promptForApiKey(!1),this.lastApiKeyPrompted=e)}else{const e=`Error sending heartbeats (${t.status}); Check your browser console for more details.`;this.showStatusBar&&(this.updateStatusBarText("WakaTime Error"),this.updateStatusBarTooltip(`WakaTime: ${e}`)),this.logger.error(e)}}catch(t){this.logger.warn(`API Error: ${t}`);const e="Error sending heartbeats; Check your browser console for more details.";this.showStatusBar&&(this.updateStatusBarText("WakaTime Error"),this.updateStatusBarTooltip(`WakaTime: ${e}`)),this.logger.error(e)}})}getCodingActivity(){if(!this.showStatusBar)return;const t=Date.now()-this.fetchTodayInterval;this.lastFetchToday>t||(this.lastFetchToday=Date.now(),this.hasApiKey(t=>{t&&this._getCodingActivity()}))}_getCodingActivity(){return s.__awaiter(this,void 0,void 0,function*(){this.logger.debug("Fetching coding activity for Today from api.");const t=this.config.get("wakatime.apiKey"),e=`${this.getApiUrl()}/users/current/statusbar/today?api_key=${t}`;try{const t=yield fetch(e,{method:"GET",headers:{"Content-Type":"application/json","User-Agent":this.agentName+"/"+a.version+" vscode-wakatime/"+this.extension.version}}),i=yield t.json();if(200==t.status){if(this.config.get("wakatime.status_bar_coding_activity"),this.showStatusBar){i.data&&(this.hasTeamFeatures=i.data.has_team_features);let t=i.data.grand_total.text;"true"!=this.config.get("wakatime.status_bar_hide_categories")&&i.data.categories.length>1&&(t=i.data.categories.map(t=>t.text+" "+t.name).join(", ")),t&&t.trim()?this.showCodingActivity?(this.updateStatusBarText(t.trim()),this.updateStatusBarTooltip("WakaTime: Today’s coding time. Click to visit dashboard.")):(this.updateStatusBarText(),this.updateStatusBarTooltip(t.trim())):(this.updateStatusBarText(),this.updateStatusBarTooltip("WakaTime: Calculating time spent today in background...")),this.updateTeamStatusBar()}}else if(this.logger.warn(`API Error ${t.status}: ${i}`),t&&401==t.status){const t="Invalid WakaTime Api Key";this.showStatusBar&&(this.updateStatusBarText("WakaTime Error"),this.updateStatusBarTooltip(`WakaTime: ${t}`)),this.logger.error(t)}else{const e=`Error fetching code stats for status bar (${t.status}); Check your browser console for more details.`;this.logger.debug(e)}}catch(t){this.logger.warn(`API Error: ${t}`)}})}updateTeamStatusBar(t){return s.__awaiter(this,void 0,void 0,function*(){var e;if(!this.showStatusBarTeam)return;if(!this.hasTeamFeatures)return;if(!t&&!(t=null===(e=a.window.activeTextEditor)||void 0===e?void 0:e.document))return;const i=o.Utils.getFocusedFile(t);if(!i)return;if(this.currentlyFocusedFile=i,this.teamDevsForFileCache[i])return void this.updateTeamStatusBarFromJson(this.teamDevsForFileCache[i]);this.logger.debug("Fetching devs for currently focused file from api.");const s=this.config.get("wakatime.apiKey"),r=`${this.getApiUrl()}/users/current/file_experts?api_key=${s}`,n={entity:i,plugin:this.agentName+"/"+a.version+" vscode-wakatime/"+this.extension.version},u=this.getProjectName();if(!u)return;n.project=u;const l=this.getProjectFolder(t.uri);if(l&&0===i.indexOf(l)){n.project_root_count=this.countSlashesInPath(l);try{const t=yield fetch(r,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":this.agentName+"/"+a.version+" vscode-wakatime/"+this.extension.version},body:JSON.stringify(n)}),e=yield t.json();if(200==t.status){const t={you:null,other:null};if(e.data){const s=e.data.find(t=>t.user.is_current_user);let a=e.data[0];a.user.is_current_user&&(a=e.data.length>1?e.data[1]:null),t.you=s,t.other=a,this.teamDevsForFileCache[i]=t}if(i!==this.currentlyFocusedFile)return;this.config.get("wakatime.status_bar_coding_activity"),this.showStatusBar&&this.updateTeamStatusBarFromJson(t)}else if(this.updateTeamStatusBarTextForCurrentUser(),this.updateTeamStatusBarTextForOther(),this.logger.warn(`API Error ${t.status}: ${e}`),t&&401==t.status)this.logger.error("Invalid WakaTime Api Key");else{const e=`Error fetching devs for currently focused file (${t.status}); Check your browser console for more details.`;this.logger.debug(e)}}catch(t){this.logger.warn(`API Error: ${t}`)}}})}updateTeamStatusBarFromJson(t){if(!t)return this.updateTeamStatusBarTextForCurrentUser(),void this.updateTeamStatusBarTextForOther();const e=t.you,i=t.other;e?(this.updateTeamStatusBarTextForCurrentUser("You: "+e.total.text),this.updateStatusBarTooltipForCurrentUser("Your total time spent in this file")):this.updateTeamStatusBarTextForCurrentUser(),i?(this.updateTeamStatusBarTextForOther(i.user.name+": "+i.total.text),this.updateStatusBarTooltipForOther(i.user.long_name+"’s total time spent in this file")):this.updateTeamStatusBarTextForOther()}recentlyAIPasted(t){return this.AIrecentPastes=this.AIrecentPastes.filter(e=>e+r.AI_RECENT_PASTES_TIME_MS>=t),this.AIrecentPastes.length>3}isDuplicateHeartbeat(t,e,i){let s=!1;return this.dedupe[t]&&this.dedupe[t].lastHeartbeatAt+18e5<e&&this.dedupe[t].selection.line==i.line&&this.dedupe[t].selection.character==i.character&&(s=!0),this.dedupe[t]={selection:i,lastHeartbeatAt:e},s}getLanguage(t){return t.languageId||""}getProjectName(){return a.workspace.name||""}getProjectFolder(t){if(!a.workspace)return"";const e=a.workspace.getWorkspaceFolder(t);if(e)try{return e.uri.fsPath}catch(t){}return a.workspace.workspaceFolders&&a.workspace.workspaceFolders.length?a.workspace.workspaceFolders[0].uri.fsPath:""}getPlugin(){const t=`${this.agentName}/${a.version} vscode-wakatime/${this.extension.version}`,e=this.getOperatingSystem();return e?`(${e}) ${t}`:t}getOperatingSystem(){if(navigator.userAgentData&&navigator.userAgentData.platform){const t=navigator.userAgentData.platform;return-1!=t.toLowerCase().indexOf("mac")?"Mac":-1!=t.toLowerCase().indexOf("win")?"Windows":-1!=t.toLowerCase().indexOf("linux")?"Linux":-1!=t.toLowerCase().indexOf("unix")?"Unix":-1!=t.toLowerCase().indexOf("android")?"Android":t}if(navigator.platform){const t=navigator.platform;return navigator.userAgent&&-1!=navigator.userAgent.toLowerCase().indexOf("android")?"Android":-1!=t.toLowerCase().indexOf("mac")?"Mac":-1!=t.toLowerCase().indexOf("win")?"Windows":-1!=t.toLowerCase().indexOf("linux")?"Linux":-1!=t.toLowerCase().indexOf("unix")?"Unix":-1!=t.toLowerCase().indexOf("android")?"Android":t}return null}getApiUrl(){let t=this.config.get("wakatime.apiUrl")||"https://api.wakatime.com/api/v1";const e=["/",".bulk","/users/current/heartbeats","/heartbeats","/heartbeat"];for(const i of e)t.endsWith(i)&&(t=t.slice(0,-i.length));return t}countSlashesInPath(t){if(!t)return 0;const e=0===t.indexOf("\\\\");return t=t.replace(/[\\/]+/,"/"),e&&(t="\\\\"+t.slice(1)),t.endsWith("/")||(t+="/"),(t.match(/\//g)||[]).length}}},921:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.SEND_BUFFER_SECONDS=e.TIME_BETWEEN_HEARTBEATS_MS=e.AI_RECENT_PASTES_TIME_MS=e.LogLevel=e.COMMAND_STATUS_BAR_ENABLED=e.COMMAND_STATUS_BAR_CODING_ACTIVITY=e.COMMAND_PROXY=e.COMMAND_LOG_FILE=e.COMMAND_DISABLE=e.COMMAND_DEBUG=e.COMMAND_DASHBOARD=e.COMMAND_CONFIG_FILE=e.COMMAND_API_URL=e.COMMAND_API_KEY=void 0,e.COMMAND_API_KEY="wakatime.apikey",e.COMMAND_API_URL="wakatime.apiurl",e.COMMAND_CONFIG_FILE="wakatime.config_file",e.COMMAND_DASHBOARD="wakatime.dashboard",e.COMMAND_DEBUG="wakatime.debug",e.COMMAND_DISABLE="wakatime.disable",e.COMMAND_LOG_FILE="wakatime.log_file",e.COMMAND_PROXY="wakatime.proxy",e.COMMAND_STATUS_BAR_CODING_ACTIVITY="wakatime.status_bar_coding_activity",e.COMMAND_STATUS_BAR_ENABLED="wakatime.status_bar_enabled",function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR"}(i||(e.LogLevel=i={})),e.AI_RECENT_PASTES_TIME_MS=500,e.TIME_BETWEEN_HEARTBEATS_MS=12e4,e.SEND_BUFFER_SECONDS=30}},e={};function i(s){var a=e[s];if(void 0!==a)return a.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};(()=>{var t=s;Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(t){var i;n=new o.WakaTime(u,t.globalState),null===(i=t.globalState)||void 0===i||i.setKeysForSync(["wakatime.apiKey"]),t.subscriptions.push(e.commands.registerCommand(a.COMMAND_API_KEY,function(){n.promptForApiKey()})),t.subscriptions.push(e.commands.registerCommand(a.COMMAND_API_URL,function(){n.promptForApiUrl()})),t.subscriptions.push(e.commands.registerCommand(a.COMMAND_DEBUG,function(){n.promptForDebug()})),t.subscriptions.push(e.commands.registerCommand(a.COMMAND_DISABLE,function(){n.promptToDisable()})),t.subscriptions.push(e.commands.registerCommand(a.COMMAND_STATUS_BAR_ENABLED,function(){n.promptStatusBarIcon()})),t.subscriptions.push(e.commands.registerCommand(a.COMMAND_STATUS_BAR_CODING_ACTIVITY,function(){n.promptStatusBarCodingActivity()})),t.subscriptions.push(e.commands.registerCommand(a.COMMAND_DASHBOARD,function(){n.openDashboardWebsite()})),t.subscriptions.push(n),n.initialize()},t.deactivate=function(){n.dispose()};const e=i(398),a=i(921),r=i(285),o=i(916);var n,u=new r.Logger(a.LogLevel.INFO)})();var a=exports;for(var r in s)a[r]=s[r];s.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})})();
//# sourceMappingURL=extension.js.map